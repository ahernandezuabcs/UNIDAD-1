<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Canvas</title>
    <style type="text/css">
        body {
            background-color: gray;
        }

        canvas {
            background-color: white;
        }
    </style>
</head>

<body>
    <canvas id="myCanvas" width="500" height="500"></canvas>
    <script>
        const myCanvas = document.getElementById("myCanvas");
        const ctx = myCanvas.getContext("2d");
        var dir = "";
        var vel = 5;

        class Rectangulo {
            constructor(axisX, axisY, width, height, fillColor, vel) {
                this.axisX = axisX;
                this.axisY = axisY;
                this.width = width;
                this.height = height;
                this.fillColor = fillColor;
                this.vel = vel;
            }

            deteccionColision(target) {
                if (this.axisX < target.axisX + target.width &&
                    this.axisX + this.width > target.axisX &&
                    this.axisY < target.axisY + target.height &&
                    this.axisY + this.height > target.axisY) {
                    return true;
                } else {
                    return false;
                }
            }
        }

        var jugador = new Rectangulo(100, 100, 20, 20, "green", 5);
        var target = new Rectangulo(300, 300, 10, 10, "red", null);
        var muro = new Rectangulo(150, 400, 200, 20, "black", null); 

        document.addEventListener("keypress", function (e) {
            switch (e.keyCode) {
                case 119: // 'w'
                    dir = "arriba";
                    break;
                case 115: // 's'
                    dir = "abajo";
                    break;
                case 97: // 'a'
                    dir = "izquierda";
                    break;
                case 100: // 'd'
                    dir = "derecha";
                    break;
                case 32: // 'space'
                    jugador.vel += 2.5;
                    break;
            }
        });

        function actualizar() {
            let nuevoX = jugador.axisX;
            let nuevoY = jugador.axisY;

            switch (dir) {
                case "arriba":
                    nuevoY -= jugador.vel;
                    break;
                case "abajo":
                    nuevoY += jugador.vel;
                    break;
                case "izquierda":
                    nuevoX -= jugador.vel;
                    break;
                case "derecha":
                    nuevoX += jugador.vel;
                    break;
            }

            if (!jugador.deteccionColision(muro)) {
                jugador.axisX = nuevoX;
                jugador.axisY = nuevoY;
            }
            
            if (jugador.axisX < 0) {
                jugador.axisX = 500;
            } else if (jugador.axisX > 500) {
                jugador.axisX = 0;
            }

            if (jugador.axisY < 0) {
                jugador.axisY = 500;
            } else if (jugador.axisY > 500) {
                jugador.axisY = 0;
            }
        }

        function moverTarget() {
            target.axisX = Math.random() * (myCanvas.width - target.width);
            target.axisY = Math.random() * (myCanvas.height - target.height);
        }

        function pintar() {
            ctx.fillStyle = "white";
            ctx.fillRect(0, 0, myCanvas.width, myCanvas.height);
            ctx.fillStyle = "black";
            ctx.fillText("Velocidad: " + jugador.vel, 10, 490);

            ctx.fillStyle = jugador.fillColor;
            ctx.fillRect(jugador.axisX, jugador.axisY, jugador.width, jugador.height);
            ctx.fillStyle = target.fillColor;
            ctx.fillRect(target.axisX, target.axisY, target.width, target.height);

            ctx.fillStyle = muro.fillColor;
            ctx.fillRect(muro.axisX, muro.axisY, muro.width, muro.height);

            if (jugador.deteccionColision(target)) {
                moverTarget();
            }

            actualizar();
            requestAnimationFrame(pintar);
        }

        requestAnimationFrame(pintar);
    </script>
</body>

</html>
